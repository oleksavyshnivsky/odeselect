/**
 * @file AJAX-populated options
 * @copyleft Oleksa Vyshnivsky <dying.escape@gmail.com> 2022
 * @license The MIT License (MIT)
 */
Node.prototype.odeselect=function(){const r=this,o=r.nextElementSibling,l=parseInt(r.dataset.osMinlength)||1,c=r.dataset.osUrl,d=document.createElement("button"),i=(d.classList.add("btn"),d.classList.add("text-danger"),d.classList.add("odeselect-cancel"),d.style.display="none",d.style.position="absolute",d.innerHTML="&times;",d.type="button",d.onclick=e=>{o.readOnly=!1,r.value="",d.style.display="none"},o.parentNode.insertBefore(d,null),document.createElement("div"));i.classList.add("odeselect-menu"),i.onkeydown=e=>{switch(e.code){case"ArrowUp":e.preventDefault(),t=(t=e.target.previousElementSibling)||o;break;case"ArrowDown":e.preventDefault();var t=e.target.nextElementSibling;break;case"Escape":i.innerHTML="",o.focus();break;default:t=null}t&&t.focus()},r.parentNode.style.position="relative",r.parentNode.insertBefore(i,null),o.onkeyup=async e=>{switch(e.code){case"ArrowDown":var t=i.querySelector("button");t&&t.focus();break;case"Escape":i.innerHTML="";break;default:var a,n,s,t=e.target.value.trim();t!==e.target.dataset.previous&&(r.value="",t.length>=l?(a={search:t},document.querySelectorAll('[data-os-for="'+r.dataset.os+'"]').forEach(e=>{a[e.dataset.osFactor]=e.value}),(n=await fetch(c+"?"+new URLSearchParams(a))).ok?(s=await n.json(),i.innerHTML="",Object.keys(s).forEach((e,t)=>{var a=document.createElement("button");a.dataset.osId=e,a.classList.add("btn"),a.innerText=s[e],a.onclick=e=>{r.value=e.target.dataset.osId,o.value=e.target.innerText,i.innerHTML="",o.readOnly=!0,d.style.display=""},i.insertBefore(a,null)})):alert("HTTP-Error: "+n.status)):i.innerHTML="",e.target.dataset.previous=t)}},r.value&&(o.readOnly=!0,d.style.display="")};